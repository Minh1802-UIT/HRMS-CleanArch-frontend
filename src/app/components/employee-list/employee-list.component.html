<div
  class="flex flex-col min-h-screen text-gray-900 transition-colors duration-200 employee-list-layout bg-background-light dark:bg-background-dark font-body dark:text-gray-100"
>
  <!-- Main Content -->
  <main class="flex-1 max-w-[1600px] mx-auto w-full px-4 sm:px-6 lg:px-8 py-6">
    <div class="flex flex-col items-center mb-10">
      <h1 class="mb-6 text-3xl font-bold text-gray-900 dark:text-white">
        Employee Management
      </h1>
      <div
        class="flex justify-center space-x-12 w-full max-w-2xl border-b border-gray-200 dark:border-gray-700"
      >
        <a
          routerLink="/employees"
          class="px-2 pb-4 text-xs font-bold tracking-widest uppercase border-b-2 transition-all cursor-pointer border-primary text-primary"
          >Team members</a
        >
        <a
          routerLink="/directory"
          class="px-2 pb-4 text-xs font-bold tracking-widest text-gray-500 uppercase border-b-2 border-transparent transition-all cursor-pointer dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:border-gray-300"
          >Directory</a
        >
        <a
          routerLink="/org-chart"
          class="px-2 pb-4 text-xs font-bold tracking-widest text-gray-500 uppercase border-b-2 border-transparent transition-all cursor-pointer dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:border-gray-300"
          >Org chart</a
        >
      </div>
    </div>

    <!-- Filter Card -->
    <div
      class="p-5 mb-6 rounded-lg border border-gray-200 shadow-sm bg-surface-light dark:bg-surface-dark dark:border-gray-700"
    >
      <!-- Action Buttons -->
      <div
        class="flex flex-col justify-end mb-6 space-y-3 sm:flex-row sm:space-y-0 sm:space-x-3"
      >
        <button
          (click)="exportEmployeesCsv()"
          class="inline-flex justify-center items-center px-4 py-2 text-sm font-medium bg-transparent rounded-md border transition-colors border-primary text-primary hover:bg-orange-50 dark:hover:bg-opacity-10"
        >
          <span class="mr-2 text-sm material-symbols-outlined">download</span>
          Export CSV
        </button>
        <button
          (click)="onAddEmployee()"
          class="inline-flex justify-center items-center px-4 py-2 text-sm font-medium text-white rounded-md border border-transparent shadow-sm transition-colors bg-primary hover:bg-orange-600"
        >
          <span class="mr-2 text-sm material-symbols-outlined">add_circle</span>
          Add new
        </button>
      </div>

      <!-- Filters Row -->
      <div
        class="flex flex-col gap-4 justify-between xl:flex-row xl:items-center"
      >
        <div
          class="flex flex-col flex-1 gap-4 items-start w-full md:flex-row md:items-center"
        >
          <!-- Search Input -->
          <div class="relative w-full md:w-64">
            <div
              class="flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"
            >
              <span class="text-sm text-gray-400 material-symbols-outlined"
                >search</span
              >
            </div>
            <input
              type="text"
              [(ngModel)]="searchTerm"
              (input)="onSearch()"
              class="block py-2 pr-3 pl-10 w-full leading-5 placeholder-gray-500 text-gray-900 bg-gray-50 rounded-md border border-gray-300 transition-colors dark:border-gray-600 dark:bg-gray-800 dark:text-white focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary sm:text-sm"
              placeholder="Search employees..."
            />
          </div>
          <div
            class="hidden mx-2 w-px h-8 bg-gray-200 md:block dark:bg-gray-700"
          ></div>
          <!-- Filter Dropdowns -->
          <div class="flex flex-col gap-3 w-full sm:flex-row">
            <select
              class="block py-2 pr-10 pl-3 w-full text-base text-gray-900 bg-gray-100 rounded-md border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm dark:bg-gray-800 dark:text-white"
            >
              <option>All Offices</option>
              <option>Axis Building</option>
              <option>Elevate Complex</option>
              <option>Innovate Tower</option>
            </select>
            <select
              class="block py-2 pr-10 pl-3 w-full text-base text-gray-900 bg-gray-100 rounded-md border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm dark:bg-gray-800 dark:text-white"
            >
              <option>All Departments</option>
              <option>Products</option>
              <option>Growth</option>
              <option>Marketing</option>
            </select>
            <select
              class="block py-2 pr-10 pl-3 w-full text-base text-gray-900 bg-gray-100 rounded-md border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm dark:bg-gray-800 dark:text-white"
            >
              <option>All Job Titles</option>
              <option>Designer</option>
              <option>Developer</option>
              <option>Manager</option>
            </select>
            <select
              class="block py-2 pr-10 pl-3 w-full text-base text-gray-900 bg-gray-100 rounded-md border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm dark:bg-gray-800 dark:text-white"
            >
              <option>All Employment Type</option>
              <option>Full-time</option>
              <option>Part-time</option>
              <option>Contractor</option>
            </select>
          </div>
        </div>
        <button
          (click)="clearFilters()"
          class="self-end text-sm text-gray-500 whitespace-nowrap transition-colors dark:text-gray-400 hover:text-primary xl:self-center"
        >
          Clear filters
        </button>
      </div>
    </div>

    <!-- Employee Table -->
    <div
      class="overflow-hidden rounded-lg border border-gray-200 shadow-sm bg-surface-light dark:bg-surface-dark dark:border-gray-700"
    >
      <!-- Loading State -->
      @if (loading) {
        <div class="flex justify-center items-center py-16">
          <div
            class="w-10 h-10 rounded-full border-t-2 border-b-2 animate-spin border-primary"
          ></div>
        </div>
      }

      @if (!loading) {
        <div class="overflow-x-auto">
          <table
            class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"
          >
            <thead class="bg-gray-50 dark:bg-gray-800/50">
              <tr>
                <th
                  scope="col"
                  class="px-6 py-4 w-10 text-xs font-medium tracking-wider text-left text-gray-500 uppercase dark:text-gray-400"
                >
                  <input
                    type="checkbox"
                    class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary dark:bg-gray-700 dark:border-gray-600"
                  />
                </th>
                <th
                  scope="col"
                  class="px-6 py-4 text-xs font-semibold tracking-wider text-left text-gray-500 uppercase dark:text-gray-400"
                >
                  Avatar
                </th>
                <th
                  scope="col"
                  class="px-6 py-4 text-xs font-semibold tracking-wider text-left text-gray-500 uppercase dark:text-gray-400"
                >
                  Name
                </th>
                <th
                  scope="col"
                  class="px-6 py-4 text-xs font-semibold tracking-wider text-left text-gray-500 uppercase dark:text-gray-400"
                >
                  Employee ID
                </th>
                <th
                  scope="col"
                  class="px-6 py-4 text-xs font-semibold tracking-wider text-left text-gray-500 uppercase dark:text-gray-400"
                >
                  Job Title
                </th>
                <th
                  scope="col"
                  class="px-6 py-4 text-xs font-semibold tracking-wider text-left text-gray-500 uppercase dark:text-gray-400"
                >
                  Department
                </th>
                <th
                  scope="col"
                  class="px-6 py-4 text-xs font-semibold tracking-wider text-left text-gray-500 uppercase dark:text-gray-400"
                >
                  Employment Type
                </th>
                <th
                  scope="col"
                  class="px-6 py-4 text-xs font-semibold tracking-wider text-left text-gray-500 uppercase dark:text-gray-400"
                >
                  Actions
                </th>
              </tr>
            </thead>
            <tbody
              class="divide-y divide-gray-200 bg-surface-light dark:bg-surface-dark dark:divide-gray-700"
            >
              @for (
                employee of paginatedEmployees;
                track trackByEmployeeId($index, employee)
              ) {
                <tr
                  class="transition-colors hover:bg-gray-50 dark:hover:bg-gray-800/50"
                >
                  <td class="px-6 py-4 whitespace-nowrap">
                    <input
                      type="checkbox"
                      class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary dark:bg-gray-700 dark:border-gray-600"
                    />
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex-shrink-0 w-10 h-10">
                      <img
                        [src]="
                          getAvatarUrl(employee.avatarUrl) ||
                          'assets/images/defaults/avatar-1.png'
                        "
                        [alt]="employee.fullName"
                        class="object-cover w-10 h-10 rounded-full"
                        onerror="
                          this.src =
                            'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjZTVlN2ViIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzljYTNhZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPj88L3RleHQ+PC9zdmc+'
                        "
                      />
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div
                      class="text-sm font-bold text-gray-900 dark:text-white"
                    >
                      {{ employee.fullName }}
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-500 dark:text-gray-400">
                      {{ employee.employeeCode }}
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900 dark:text-white">
                      {{ getPositionTitle(employee) }}
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900 dark:text-white">
                      {{ getDepartmentName(employee) }}
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span
                      [ngClass]="getEmploymentTypeClass(employee)"
                      class="inline-flex px-2 text-xs font-semibold leading-5 rounded-full"
                    >
                      {{ getEmploymentType(employee) }}
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex gap-2 items-center">
                      <a
                        [routerLink]="['/employees', employee.id]"
                        class="p-1.5 text-gray-400 rounded transition-colors hover:text-primary hover:bg-orange-50 dark:hover:bg-orange-900/20"
                        title="View Profile"
                      >
                        <span class="text-sm material-symbols-outlined"
                          >visibility</span
                        >
                      </a>
                    </div>
                  </td>
                </tr>
              }
              <!-- Empty State -->
              @if (paginatedEmployees.length === 0 && !loading) {
                <tr>
                  <td
                    colspan="8"
                    class="py-12 text-center text-gray-500 dark:text-gray-400"
                  >
                    <div class="flex flex-col items-center">
                      <span
                        class="mb-2 text-4xl text-gray-300 material-symbols-outlined"
                        >inbox</span
                      >
                      <p class="text-lg font-medium">No employees found</p>
                      <p class="text-sm">
                        Try adjusting your search or filter criteria
                      </p>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    </div>

    <!-- Pagination -->
    <div
      class="flex flex-col justify-between items-center px-1 mt-6 sm:flex-row"
    >
      <div class="mb-4 text-sm text-gray-500 dark:text-gray-400 sm:mb-0">
        Show
        <span class="font-medium text-gray-900 dark:text-white">{{
          (currentPage - 1) * pageSize + 1
        }}</span>
        to
        <span class="font-medium text-gray-900 dark:text-white">{{
          Math.min(currentPage * pageSize, totalItems)
        }}</span>
        of
        <span class="font-medium text-gray-900 dark:text-white">{{
          totalItems
        }}</span>
        results
      </div>
      <nav
        aria-label="Pagination"
        class="inline-flex relative z-0 -space-x-px rounded-md shadow-sm"
      >
        <button
          (click)="goToPage(currentPage - 1)"
          [disabled]="currentPage === 1"
          class="inline-flex relative items-center px-2 py-2 text-sm font-medium text-gray-500 rounded-l-md border border-gray-300 dark:border-gray-600 bg-surface-light dark:bg-surface-dark dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <span class="text-sm material-symbols-outlined">chevron_left</span>
        </button>
        @for (page of getPageNumbers(); track trackByPage($index, page)) {
          <button
            (click)="goToPage(page)"
            [class.bg-primary]="page === currentPage"
            [class.border-primary]="page === currentPage"
            [class.text-white]="page === currentPage"
            class="inline-flex relative items-center px-4 py-2 text-sm font-medium border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800"
            [ngClass]="{
              'bg-surface-light dark:bg-surface-dark text-gray-500 dark:text-gray-400':
                page !== currentPage,
            }"
          >
            {{ page }}
          </button>
        }
        <button
          (click)="goToPage(currentPage + 1)"
          [disabled]="currentPage === totalPages"
          class="inline-flex relative items-center px-2 py-2 text-sm font-medium text-gray-500 rounded-r-md border border-gray-300 dark:border-gray-600 bg-surface-light dark:bg-surface-dark dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <span class="text-sm material-symbols-outlined">chevron_right</span>
        </button>
      </nav>
    </div>
  </main>

  <!-- Edit/Add Employee Drawer -->
  @if (showEditDrawer) {
    <div class="flex fixed inset-0 z-50 justify-end items-center">
      <div
        class="absolute inset-0 backdrop-blur-sm transition-opacity bg-gray-900/40"
        (click)="closeEditDrawer()"
      ></div>
      <div
        class="overflow-hidden relative w-full max-w-4xl h-full bg-white border-l border-gray-200 shadow-2xl transition-all transform dark:bg-gray-900 dark:border-gray-700"
      >
        <app-add-employee
          [employeeId]="selectedEmployeeId"
          (close)="closeEditDrawer()"
          (employeeAdded)="onEmployeeSaved()"
        ></app-add-employee>
      </div>
    </div>
  }
</div>
